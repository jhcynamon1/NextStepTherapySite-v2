<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Dashboard - Next Step Therapy</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .debug { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .metric { background: #e3f2fd; padding: 10px; margin: 5px 0; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ğŸ” Dashboard Debug Tool</h1>
    
    <div id="debugLog"></div>
    
    <h2>ğŸ“Š Data Display</h2>
    <div class="metric">Total Impressions: <span id="impressions">-</span></div>
    <div class="metric">Total Clicks: <span id="clicks">-</span></div>
    <div class="metric">Average CTR: <span id="ctr">-</span></div>
    <div class="metric">Average Position: <span id="position">-</span></div>

    <script>
        function log(message, type = 'info') {
            const debugLog = document.getElementById('debugLog');
            const div = document.createElement('div');
            div.className = `debug ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> ${message}`;
            debugLog.appendChild(div);
            console.log(message);
        }

        async function debugDashboard() {
            log('ğŸš€ Starting dashboard debug...', 'info');
            
            try {
                // Step 1: Check if we can reach the server
                log('ğŸ“¡ Step 1: Testing server connection...', 'info');
                const pingResponse = await fetch('/');
                log(`âœ… Server responds: ${pingResponse.status} ${pingResponse.statusText}`, 'success');
                
                // Step 2: Check if data file exists
                log('ğŸ“ Step 2: Checking data file...', 'info');
                const dataResponse = await fetch('/dashboard_data/dashboard_data.json');
                log(`ğŸ“Š Data file response: ${dataResponse.status} ${dataResponse.statusText}`, dataResponse.ok ? 'success' : 'error');
                
                if (!dataResponse.ok) {
                    throw new Error(`Data file not accessible: ${dataResponse.status}`);
                }
                
                // Step 3: Parse JSON
                log('ğŸ”„ Step 3: Parsing JSON data...', 'info');
                const data = await dataResponse.json();
                log(`âœ… JSON parsed successfully. Keys: ${Object.keys(data).join(', ')}`, 'success');
                
                // Step 4: Display data
                log('ğŸ“ˆ Step 4: Displaying metrics...', 'info');
                
                if (data.summary) {
                    document.getElementById('impressions').textContent = data.summary.totalImpressions?.toLocaleString() || 'N/A';
                    document.getElementById('clicks').textContent = data.summary.totalClicks?.toLocaleString() || 'N/A';
                    document.getElementById('ctr').textContent = (data.summary.averageCTR || 0) + '%';
                    document.getElementById('position').textContent = data.summary.averagePosition || 'N/A';
                    
                    log(`âœ… Metrics displayed: ${data.summary.totalImpressions} impressions, ${data.summary.totalClicks} clicks`, 'success');
                } else {
                    log('âŒ No summary data found in JSON', 'error');
                }
                
                // Step 5: Show raw data structure
                log('ğŸ“‹ Step 5: Raw data structure:', 'info');
                log(`<pre>${JSON.stringify(data, null, 2).substring(0, 500)}...</pre>`, 'info');
                
                log('ğŸ‰ Debug complete - dashboard should work!', 'success');
                
            } catch (error) {
                log(`âŒ Error: ${error.message}`, 'error');
                log(`ğŸ” Stack: ${error.stack}`, 'error');
            }
        }

        // Run debug when page loads
        document.addEventListener('DOMContentLoaded', debugDashboard);
    </script>
</body>
</html>
