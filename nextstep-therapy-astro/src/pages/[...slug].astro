---
import StandardPage from './_templates/StandardPage.astro';
import canonicals from '../data/canonicals.json';

const slugParam = Astro.params.slug;
const slug = Array.isArray(slugParam) ? slugParam.join('/') : slugParam ?? '';

const noindexEntries = canonicals.filter((entry) => entry.noindex === true);
const placeholderMap = new Map(noindexEntries.map((entry) => [entry.path.replace(/^\//, ''), entry]));

if (!placeholderMap.has(slug)) {
  return new Response(null, { status: 404 });
}

const overrides = {
  'faq': {
    title: 'Therapy FAQ for Ontario Clients',
    description: 'Answers to common questions about psychotherapy, insurance, privacy, and getting started with Next Step Therapy.',
    intro: 'We are finalizing detailed responses to the most common questions about working with a CRPO-registered psychotherapist. In the meantime, here is a quick overview.',
    links: [
      { href: '/services', label: 'Services' },
      { href: '/contact', label: 'Contact' },
      { href: '/resources/therapy-cost-without-insurance', label: 'Therapy Cost Guide' }
    ]
  },
  'students/college-anxiety': {
    title: 'College Anxiety Counselling in Ontario',
    description: 'Therapy support for college students dealing with stress, overwhelm, and transitions.',
    intro: 'A detailed breakdown of college stress management is coming soon. The counselling team is available now for virtual sessions.',
    links: [
      { href: '/students/study-anxiety', label: 'Study Anxiety' },
      { href: '/students/student-mental-health', label: 'Student Mental Health' },
      { href: '/contact', label: 'Book a Consultation' }
    ]
  },
  'students/study-anxiety': {
    title: 'Study Anxiety Therapy for Ontario Students',
    description: 'Reduce panic and procrastination with therapy tailored to study anxiety.',
    intro: 'Our comprehensive guide to beating study anxiety is in progress. Sessions are available now for students who need targeted support during exam cycles.',
    links: [
      { href: '/students/university-anxiety', label: 'University Anxiety' },
      { href: '/contact', label: 'Contact' }
    ]
  },
  'students/student-mental-health': {
    title: 'Student Mental Health Therapy in Ontario',
    description: 'Comprehensive therapy for Ontario students balancing academics, transitions, and mental health.',
    intro: 'We are building a full hub for students navigating mental health, academics, and campus life. Until then, book a consultation to access student-focused support immediately.',
    links: [
      { href: '/students/university-anxiety', label: 'University Anxiety' },
      { href: '/contact', label: 'Contact' }
    ]
  },
  'virtual-therapy/busy-parents': {
    title: 'Virtual Therapy for Busy Parents in Ontario',
    description: 'Flexible online therapy for parents juggling work, caregiving, and stress.',
    intro: 'This page is being expanded with scheduling tips, boundary-setting tools, and stories from parents who found more balance. Sessions are available now if you need support before the full guide launches.',
    links: [
      { href: '/virtual-therapy-ontario', label: 'Virtual Therapy Ontario' },
      { href: '/services', label: 'Services' }
    ]
  },
  'professionals/workplace-stress': {
    title: 'Workplace Stress Therapy for Ontario Professionals',
    description: 'Confidential therapy for professionals managing workplace stress and burnout.',
    intro: 'Full program details are coming soon. We are finalizing case studies, leadership tools, and stress-reduction plans specific to high-pressure careers.',
    links: [
      { href: '/professionals/workplace-burnout-therapy', label: 'Burnout Therapy' },
      { href: '/contact', label: 'Contact' }
    ]
  },
  'professionals/workplace-burnout-therapy': {
    title: 'Burnout Therapy for Professionals',
    description: 'Evidence-based therapy for burnout, emotional exhaustion, and chronic workplace stress.',
    intro: 'We are building a comprehensive burnout recovery resource including phased plans, rest strategies, and leadership support.',
    links: [
      { href: '/professionals/workplace-stress', label: 'Workplace Stress' },
      { href: '/contact', label: 'Contact' }
    ]
  },
  'resources/therapy-cost-without-insurance': {
    title: 'How to Manage Therapy Costs Without Insurance in Ontario',
    description: 'Understand pricing, sliding scales, and tax credits for psychotherapy when benefits arenâ€™t available.',
    intro: 'We are compiling detailed guidance on budgeting for therapy, accessing tax credits, and combining resources. Contact us if you need immediate cost information.',
    links: [
      { href: '/services', label: 'Services' },
      { href: '/contact', label: 'Contact' }
    ]
  },
  'resources/panic-attacks-driving': {
    title: 'How Therapy Helps Panic Attacks While Driving',
    description: 'Learn coping skills and therapy approaches for panic attacks behind the wheel.',
    intro: 'Detailed strategies are on the way. The finished article will include exposure ideas, safety planning, and relaxation drills tailored to Ontario drivers.',
    links: [
      { href: '/anxiety-therapy-ontario', label: 'Anxiety Therapy' },
      { href: '/contact', label: 'Contact' }
    ]
  },
  'locations/toronto/depression-therapy': {
    title: 'Depression Therapy in Toronto',
    description: 'Personalized depression therapy for Toronto residents with evidence-based ACT and CBT.',
    intro: 'A comprehensive location page is in progress. Until then, we are accepting Toronto-based clients for virtual and select in-person intensives.',
    links: [
      { href: '/depression-therapy-ontario', label: 'Ontario Depression Therapy' },
      { href: '/contact', label: 'Contact' }
    ]
  },
  'locations/ottawa/depression-therapy': {
    title: 'Depression Therapy in Ottawa',
    description: 'CRPO-registered depression therapy for residents of Ottawa and surrounding areas.',
    intro: 'Full Ottawa-specific details are coming soon, including local resources and scheduling options. Reach out to begin therapy right away.',
    links: [
      { href: '/depression-therapy-ontario', label: 'Ontario Depression Therapy' },
      { href: '/contact', label: 'Contact' }
    ]
  },
  'locations/hamilton/workplace-stress': {
    title: 'Workplace Stress Counselling in Hamilton',
    description: 'Therapy for professionals in Hamilton managing burnout, anxiety, and leadership stress.',
    intro: 'We are preparing location-specific details for Hamilton professionals. Sessions are available virtually while we finalize onsite programming.',
    links: [
      { href: '/professionals/workplace-stress', label: 'Workplace Stress' },
      { href: '/contact', label: 'Contact' }
    ]
  }
};

function titleCase(value) {
  return value
    .split('-')
    .map((part) => part.charAt(0).toUpperCase() + part.slice(1))
    .join(' ');
}

const override = overrides[slug] ?? {};
const title = override.title ?? titleCase(slug.split('/').pop() ?? 'Page');
const description = override.description ?? `Placeholder content for ${title}. Contact us for full details.`;
const intro = override.intro ?? `We are preparing a detailed resource on ${title.toLowerCase()}. Reach out to start therapy before the full page is published.`;
const links = override.links ?? [
  { href: '/services', label: 'Services' },
  { href: '/contact', label: 'Contact' }
];

const category = slug.includes('/') ? slug.split('/')[0] : 'general';

const breadcrumbLookup = {
  students: { label: 'Students', url: 'https://nextsteptherapy.ca/students/student-mental-health' },
  services: { label: 'Services', url: 'https://nextsteptherapy.ca/services' },
  'virtual-therapy': { label: 'Virtual Therapy', url: 'https://nextsteptherapy.ca/virtual-therapy-ontario' },
  professionals: { label: 'Professionals', url: 'https://nextsteptherapy.ca/professionals/workplace-stress' },
  resources: { label: 'Resources', url: 'https://nextsteptherapy.ca/services' },
  locations: { label: 'Locations', url: 'https://nextsteptherapy.ca/services' },
  general: { label: 'Services', url: 'https://nextsteptherapy.ca/services' }
};

const canonical = `https://nextsteptherapy.ca/${slug}`;
const breadcrumbs = [
  { label: 'Home', url: 'https://nextsteptherapy.ca/' },
  breadcrumbLookup[category] ?? breadcrumbLookup.general,
  { label: title, url: canonical }
];
---
<StandardPage
  frontmatter={{
    title,
    description,
    canonical,
    breadcrumbs,
    structuredDataType: 'service',
    noindex: true
  }}
>
  <div slot="hero">
    <h1>{title}</h1>
    <p class="lead-text">{intro}</p>
  </div>

  <section>
    <h2>What to Expect</h2>
    <p>
      We are writing in-depth guidance for this topic. Sessions are available immediately, and the full resource will be
      published shortly. Until then, book a consultation to receive tailored advice and interim materials.
    </p>
  </section>

  <section>
    <h2>Next Steps</h2>
    <p>
      Share your goals when you reach out. We will provide interim materials, schedule time with a CRPO-registered
      therapist, and coordinate with other providers when appropriate.
    </p>
  </section>

  <div slot="aside">
    <div class="card">
      <h3>Helpful Links</h3>
      <ul>
        {links.map((item) => (
          <li><a href={item.href}>{item.label}</a></li>
        ))}
      </ul>
    </div>
  </div>
</StandardPage>
