<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Agency Dashboard - Next Step Therapy</title>
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-blue: #4A6B7A;
            --success-green: #10B981;
            --warning-orange: #F59E0B;
            --danger-red: #EF4444;
            --neutral-gray: #6B7280;
            --background: #F9FAFB;
            --white: #FFFFFF;
            --text-dark: #1F2937;
            --text-light: #6B7280;
            --border: #E5E7EB;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .dashboard-header {
            background: var(--white);
            padding: 2rem;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .dashboard-subtitle {
            color: var(--text-light);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .dashboard-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
            text-align: center;
        }

        .summary-label {
            font-size: 0.75rem;
            color: var(--text-light);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .summary-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .page-performance-table {
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            background: var(--background);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .filter-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            background: var(--white);
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--background);
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.875rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            color: var(--text-dark);
            font-size: 0.875rem;
        }

        .page-title {
            font-weight: 600;
            color: var(--primary-blue);
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .page-type {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .page-type.homepage { background: #DBEAFE; color: #1E40AF; }
        .page-type.seo-page { background: #D1FAE5; color: #065F46; }
        .page-type.service-page { background: #FEF3C7; color: #92400E; }
        .page-type.info-page { background: #F3E8FF; color: #6B21A8; }
        .page-type.content-page { background: #F1F5F9; color: #475569; }

        .position-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
            min-width: 50px;
        }

        .position-excellent { background: #DCFCE7; color: #166534; }
        .position-good { background: #FEF3C7; color: #92400E; }
        .position-fair { background: #FED7AA; color: #9A3412; }
        .position-poor { background: #FEE2E2; color: #991B1B; }

        .ctr-value {
            font-weight: 600;
        }

        .ctr-high { color: var(--success-green); }
        .ctr-medium { color: var(--warning-orange); }
        .ctr-low { color: var(--danger-red); }

        .opportunity-score {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 40px;
            text-align: center;
        }

        .opportunity-high { background: #DCFCE7; color: #166534; }
        .opportunity-medium { background: #FEF3C7; color: #92400E; }
        .opportunity-low { background: #F1F5F9; color: #475569; }

        .top-query {
            font-style: italic;
            color: var(--text-light);
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .insights-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        .insights-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }

        .insight-item {
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary-blue);
            background: var(--background);
            border-radius: 0 8px 8px 0;
        }

        .insight-type {
            font-weight: 600;
            color: var(--primary-blue);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .insight-text {
            margin-top: 0.5rem;
            color: var(--text-dark);
            font-size: 0.875rem;
        }

        .chart-container {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
            height: 400px;
        }

        .sortable {
            cursor: pointer;
            user-select: none;
        }

        .sortable:hover {
            background: #f8fafc;
        }

        .sort-icon {
            margin-left: 0.5rem;
            opacity: 0.5;
        }

        @media (max-width: 1200px) {
            .insights-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <div class="header-content">
            <div>
                <h1 class="dashboard-title">ðŸŽ¯ SEO Agency Dashboard</h1>
                <p class="dashboard-subtitle">Page-level performance analysis â€¢ A/B testing insights â€¢ Ranking opportunities</p>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 0.875rem; color: var(--text-light);">Last updated: <span id="lastUpdated">Loading...</span></div>
                <div style="font-size: 0.75rem; color: var(--text-light); margin-top: 0.25rem;">24 pages tracked â€¢ 174 keywords monitored</div>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Summary Cards -->
        <div class="summary-grid">
            <div class="summary-card">
                <div class="summary-label">Total Pages</div>
                <div class="summary-value" id="totalPages">24</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Avg Position</div>
                <div class="summary-value" id="avgPosition">45.2</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Total Impressions</div>
                <div class="summary-value" id="totalImpressions">1,699</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Total Clicks</div>
                <div class="summary-value" id="totalClicks">87</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">Avg CTR</div>
                <div class="summary-value" id="avgCTR">5.12%</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">High Opportunities</div>
                <div class="summary-value" id="highOpportunities">0</div>
            </div>
        </div>

        <!-- Page Performance Table -->
        <div class="page-performance-table">
            <div class="table-header">
                <h3 class="table-title">ðŸ“Š Page Performance Analysis</h3>
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterPages('all')">All Pages</button>
                    <button class="filter-btn" onclick="filterPages('seo')">SEO Pages</button>
                    <button class="filter-btn" onclick="filterPages('high-opportunity')">High Opportunity</button>
                    <button class="filter-btn" onclick="filterPages('top-performers')">Top Performers</button>
                </div>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sortTable('title')">Page <span class="sort-icon">â†•</span></th>
                            <th class="sortable" onclick="sortTable('pageType')">Type <span class="sort-icon">â†•</span></th>
                            <th class="sortable" onclick="sortTable('impressions')">Impressions <span class="sort-icon">â†•</span></th>
                            <th class="sortable" onclick="sortTable('clicks')">Clicks <span class="sort-icon">â†•</span></th>
                            <th class="sortable" onclick="sortTable('ctr')">CTR <span class="sort-icon">â†•</span></th>
                            <th class="sortable" onclick="sortTable('avgPosition')">Avg Position <span class="sort-icon">â†•</span></th>
                            <th class="sortable" onclick="sortTable('totalQueries')">Keywords <span class="sort-icon">â†•</span></th>
                            <th class="sortable" onclick="sortTable('opportunityScore')">Opportunity <span class="sort-icon">â†•</span></th>
                            <th>Top Query</th>
                        </tr>
                    </thead>
                    <tbody id="pageTableBody">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Insights Grid -->
        <div class="insights-grid">
            <div class="insights-card">
                <h3 class="insights-title">ðŸš€ High Priority Actions</h3>
                <div id="highPriorityInsights">
                    <div class="insight-item">
                        <div class="insight-type">Top Performer</div>
                        <div class="insight-text">Your "About" page has the highest CTR at 8.49% with good position (10.2). This shows strong brand recognition for "jesse cynamon".</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-type">Quick Win</div>
                        <div class="insight-text">Homepage has 193 impressions but only 4.15% CTR. Optimize title/meta description to improve click-through rate.</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-type">Content Gap</div>
                        <div class="insight-text">Performance anxiety pages have impressions but 0% CTR. Content may not match search intent - review and optimize.</div>
                    </div>
                </div>
            </div>

            <div class="insights-card">
                <h3 class="insights-title">ðŸ“ˆ A/B Testing Opportunities</h3>
                <div id="abTestingInsights">
                    <div class="insight-item">
                        <div class="insight-type">Title Tag Test</div>
                        <div class="insight-text">Test emotional vs. clinical titles for anxiety-related pages. Current 0% CTR suggests titles aren't compelling.</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-type">Content Format</div>
                        <div class="insight-text">Long-form content pages (core values, perfectionism) have low engagement. Test shorter, more actionable formats.</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-type">Local vs Generic</div>
                        <div class="insight-text">Test Toronto-specific vs. generic therapy content. "Toronto" pages show mixed performance.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chart Container -->
        <div class="chart-container" style="margin-top: 2rem;">
            <h3 style="margin-bottom: 1rem;">ðŸ“Š Position vs. Impressions Analysis</h3>
            <canvas id="positionChart"></canvas>
        </div>
    </div>

    <script>
        // Page data (loaded from GSC API)
        const pageData = [
            {
                title: "Homepage",
                pageType: "Homepage",
                impressions: 193,
                clicks: 8,
                ctr: 4.15,
                avgPosition: 33.6,
                totalQueries: 30,
                opportunityScore: 5,
                topQuery: "next step counselling"
            },
            {
                title: "About",
                pageType: "Info Page",
                impressions: 106,
                clicks: 9,
                ctr: 8.49,
                avgPosition: 10.2,
                totalQueries: 5,
                opportunityScore: 5,
                topQuery: "jesse cynamon"
            },
            {
                title: "Performance Anxiety",
                pageType: "Content Page",
                impressions: 105,
                clicks: 1,
                ctr: 0.95,
                avgPosition: 51.2,
                totalQueries: 5,
                opportunityScore: 3,
                topQuery: "performance anxiety therapy"
            },
            {
                title: "Core Values & Peak Performance",
                pageType: "Content Page",
                impressions: 84,
                clicks: 0,
                ctr: 0,
                avgPosition: 55.9,
                totalQueries: 7,
                opportunityScore: 0,
                topQuery: "achieving professional fulfilment"
            },
            {
                title: "Performance Anxiety Therapy Toronto",
                pageType: "Content Page",
                impressions: 74,
                clicks: 0,
                ctr: 0,
                avgPosition: 42.2,
                totalQueries: 7,
                opportunityScore: 0,
                topQuery: "performance psychology services toronto"
            },
            {
                title: "Perfectionism & Burnout",
                pageType: "Content Page",
                impressions: 50,
                clicks: 0,
                ctr: 0,
                avgPosition: 59,
                totalQueries: 4,
                opportunityScore: 0,
                topQuery: "therapy for perfectionism and burnout"
            },
            {
                title: "Professional Growth Through Therapy",
                pageType: "Content Page",
                impressions: 47,
                clicks: 1,
                ctr: 2.13,
                avgPosition: 61.9,
                totalQueries: 6,
                opportunityScore: 0,
                topQuery: "therapy for professionals"
            },
            {
                title: "Work Stress Assessment",
                pageType: "Content Page",
                impressions: 42,
                clicks: 2,
                ctr: 4.76,
                avgPosition: 86,
                totalQueries: 1,
                opportunityScore: 2,
                topQuery: "how to measure workplace stress"
            }
        ];

        let currentSort = { column: 'impressions', direction: 'desc' };
        let currentFilter = 'all';

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadPageData();
            createPositionChart();
            updateLastUpdated();
        });

        function loadPageData() {
            renderPageTable(pageData);
            updateSummaryCards();
        }

        function renderPageTable(data) {
            const tbody = document.getElementById('pageTableBody');
            tbody.innerHTML = '';

            data.forEach(page => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><div class="page-title" title="${page.title}">${page.title}</div></td>
                    <td><span class="page-type ${page.pageType.toLowerCase().replace(/\s+/g, '-')}">${page.pageType}</span></td>
                    <td>${page.impressions.toLocaleString()}</td>
                    <td>${page.clicks.toLocaleString()}</td>
                    <td><span class="ctr-value ${getCTRClass(page.ctr)}">${page.ctr}%</span></td>
                    <td><span class="position-badge ${getPositionClass(page.avgPosition)}">${page.avgPosition}</span></td>
                    <td>${page.totalQueries}</td>
                    <td><span class="opportunity-score ${getOpportunityClass(page.opportunityScore)}">${page.opportunityScore}/10</span></td>
                    <td><div class="top-query" title="${page.topQuery}">${page.topQuery}</div></td>
                `;
                tbody.appendChild(row);
            });
        }

        function getCTRClass(ctr) {
            if (ctr >= 5) return 'ctr-high';
            if (ctr >= 2) return 'ctr-medium';
            return 'ctr-low';
        }

        function getPositionClass(position) {
            if (position <= 3) return 'position-excellent';
            if (position <= 10) return 'position-good';
            if (position <= 20) return 'position-fair';
            return 'position-poor';
        }

        function getOpportunityClass(score) {
            if (score >= 7) return 'opportunity-high';
            if (score >= 4) return 'opportunity-medium';
            return 'opportunity-low';
        }

        function updateSummaryCards() {
            const totalImpressions = pageData.reduce((sum, p) => sum + p.impressions, 0);
            const totalClicks = pageData.reduce((sum, p) => sum + p.clicks, 0);
            const avgCTR = totalImpressions > 0 ? (totalClicks / totalImpressions * 100) : 0;
            const avgPosition = pageData.reduce((sum, p) => sum + p.avgPosition, 0) / pageData.length;
            const highOpportunities = pageData.filter(p => p.opportunityScore >= 6).length;

            document.getElementById('totalPages').textContent = pageData.length;
            document.getElementById('avgPosition').textContent = avgPosition.toFixed(1);
            document.getElementById('totalImpressions').textContent = totalImpressions.toLocaleString();
            document.getElementById('totalClicks').textContent = totalClicks.toLocaleString();
            document.getElementById('avgCTR').textContent = avgCTR.toFixed(2) + '%';
            document.getElementById('highOpportunities').textContent = highOpportunities;
        }

        function sortTable(column) {
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'desc';
            }

            const sortedData = [...pageData].sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];

                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }

                if (currentSort.direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });

            renderPageTable(sortedData);
        }

        function filterPages(filter) {
            currentFilter = filter;
            
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            let filteredData = pageData;

            switch (filter) {
                case 'seo':
                    filteredData = pageData.filter(p => p.pageType === 'SEO Page');
                    break;
                case 'high-opportunity':
                    filteredData = pageData.filter(p => p.opportunityScore >= 6);
                    break;
                case 'top-performers':
                    filteredData = pageData.filter(p => p.clicks > 0 && p.ctr > 3);
                    break;
            }

            renderPageTable(filteredData);
        }

        function createPositionChart() {
            const ctx = document.getElementById('positionChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Pages',
                        data: pageData.map(p => ({
                            x: p.avgPosition,
                            y: p.impressions,
                            title: p.title,
                            ctr: p.ctr
                        })),
                        backgroundColor: pageData.map(p => {
                            if (p.ctr > 5) return '#10B981';
                            if (p.ctr > 2) return '#F59E0B';
                            return '#EF4444';
                        }),
                        borderColor: '#4A6B7A',
                        borderWidth: 1,
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    return [
                                        `Page: ${point.title}`,
                                        `Position: ${point.x}`,
                                        `Impressions: ${point.y}`,
                                        `CTR: ${point.ctr}%`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Average Position (lower is better)'
                            },
                            reverse: true
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Impressions'
                            }
                        }
                    }
                }
            });
        }

        function updateLastUpdated() {
            document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
        }
    </script>
</body>
</html>
