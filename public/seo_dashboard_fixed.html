<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Performance Dashboard - Next Step Therapy</title>
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    
    <style>
        :root {
            --primary-blue: #4A6B7A;
            --primary-light: #6B89A0;
            --success-green: #10B981;
            --warning-orange: #F59E0B;
            --danger-red: #EF4444;
            --neutral-gray: #6B7280;
            --background: #F9FAFB;
            --white: #FFFFFF;
            --text-dark: #1F2937;
            --text-light: #6B7280;
            --border: #E5E7EB;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .dashboard-header {
            background: var(--white);
            padding: 2rem;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .last-updated {
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        .metric-label {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .metric-change {
            font-size: 0.875rem;
            font-weight: 500;
        }

        .metric-change.positive {
            color: var(--success-green);
        }

        .metric-change.negative {
            color: var(--danger-red);
        }

        .metric-change.neutral {
            color: var(--text-light);
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }

        .data-table {
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            background: var(--background);
        }

        .table-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--background);
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        td {
            color: var(--text-dark);
        }

        .page-link {
            color: var(--primary-blue);
            text-decoration: none;
            font-weight: 500;
        }

        .page-link:hover {
            text-decoration: underline;
        }

        .ranking-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
            min-width: 40px;
        }

        .ranking-excellent {
            background: #DCFCE7;
            color: #166534;
        }

        .ranking-good {
            background: #FEF3C7;
            color: #92400E;
        }

        .ranking-needs-work {
            background: #FEE2E2;
            color: #991B1B;
        }

        .conversion-rate {
            font-weight: 600;
        }

        .conversion-high {
            color: var(--success-green);
        }

        .conversion-medium {
            color: var(--warning-orange);
        }

        .conversion-low {
            color: var(--danger-red);
        }

        .refresh-button {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .refresh-button:hover {
            background: var(--primary-light);
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-light);
        }

        .error {
            text-align: center;
            padding: 2rem;
            color: var(--danger-red);
            background: #FEE2E2;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .insights-section {
            margin-top: 2rem;
            background: var(--white);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        .insights-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }

        .insight-item {
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary-blue);
            background: var(--background);
            border-radius: 0 8px 8px 0;
        }

        .insight-type {
            font-weight: 600;
            color: var(--primary-blue);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .insight-text {
            margin-top: 0.5rem;
            color: var(--text-dark);
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-container {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <div class="header-content">
            <h1 class="dashboard-title">SEO Performance Dashboard</h1>
            <div>
                <button class="refresh-button" onclick="refreshData()">Refresh Data</button>
                <div class="last-updated" id="lastUpdated">Last updated: Loading...</div>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Key Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">Total Impressions</div>
                <div class="metric-value" id="totalImpressions">Loading...</div>
                <div class="metric-change" id="impressionsChange">Loading...</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Total Clicks</div>
                <div class="metric-value" id="totalClicks">Loading...</div>
                <div class="metric-change" id="clicksChange">Loading...</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Average CTR</div>
                <div class="metric-value" id="averageCTR">Loading...</div>
                <div class="metric-change" id="ctrChange">Loading...</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Total Conversions</div>
                <div class="metric-value" id="totalConversions">Loading...</div>
                <div class="metric-change" id="conversionsChange">Loading...</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Total Revenue</div>
                <div class="metric-value" id="totalRevenue">Loading...</div>
                <div class="metric-change" id="revenueChange">Loading...</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Avg. Position</div>
                <div class="metric-value" id="averagePosition">Loading...</div>
                <div class="metric-change" id="positionChange">Loading...</div>
            </div>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
            <div class="chart-card">
                <h3 class="chart-title">Performance Trends (Last 30 Days)</h3>
                <canvas id="trendsChart" width="400" height="200"></canvas>
            </div>
            <div class="chart-card">
                <h3 class="chart-title">Top Keywords</h3>
                <div id="topKeywords">Loading...</div>
            </div>
        </div>

        <!-- Page Performance Table -->
        <div class="data-table">
            <div class="table-header">
                <h3 class="table-title">Page Performance Analysis</h3>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Page</th>
                            <th>Avg. Position</th>
                            <th>Impressions</th>
                            <th>Clicks</th>
                            <th>CTR</th>
                            <th>Conversions</th>
                            <th>Revenue</th>
                        </tr>
                    </thead>
                    <tbody id="pagePerformanceTable">
                        <tr>
                            <td colspan="7" class="loading">Loading page performance data...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- AI Insights -->
        <div class="insights-section">
            <h3 class="insights-title">🤖 AI-Powered Insights & Recommendations</h3>
            <div id="insightsContainer">
                <div class="loading">Analyzing your data for insights...</div>
            </div>
        </div>
    </div>

    <script>
        // Dashboard data and functionality
        let dashboardData = {};

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
        });

        async function loadDashboardData() {
            try {
                console.log('🔄 Loading dashboard data...');
                
                // Fetch real data from JSON file
                const response = await fetch('/dashboard_data/dashboard_data.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                dashboardData = await response.json();
                console.log('✅ Dashboard data loaded:', dashboardData);
                
                updateMetrics();
                updateCharts();
                updateTable();
                updateInsights();
                updateLastUpdated();
                
            } catch (error) {
                console.error('❌ Error loading dashboard data:', error);
                showError('Failed to load dashboard data: ' + error.message);
            }
        }

        function updateMetrics() {
            const { summary } = dashboardData;
            
            document.getElementById('totalImpressions').textContent = summary.totalImpressions.toLocaleString();
            document.getElementById('totalClicks').textContent = summary.totalClicks.toLocaleString();
            document.getElementById('averageCTR').textContent = summary.averageCTR + '%';
            document.getElementById('totalConversions').textContent = summary.totalConversions;
            document.getElementById('totalRevenue').textContent = '$' + summary.totalRevenue.toLocaleString();
            document.getElementById('averagePosition').textContent = summary.averagePosition;

            // Update change indicators
            updateChangeIndicator('impressionsChange', summary.changes.impressions);
            updateChangeIndicator('clicksChange', summary.changes.clicks);
            updateChangeIndicator('ctrChange', summary.changes.ctr);
            updateChangeIndicator('conversionsChange', summary.changes.conversions);
            updateChangeIndicator('revenueChange', summary.changes.revenue);
            updateChangeIndicator('positionChange', summary.changes.position, true);
        }

        function updateChangeIndicator(elementId, change, inverse = false) {
            const element = document.getElementById(elementId);
            const isPositive = inverse ? change < 0 : change > 0;
            const isNegative = inverse ? change > 0 : change < 0;
            
            element.textContent = (change > 0 ? '+' : '') + Math.round(change * 100) / 100 + '%';
            element.className = 'metric-change ' + (isPositive ? 'positive' : isNegative ? 'negative' : 'neutral');
        }

        function updateCharts() {
            // Trends Chart
            const trendsCtx = document.getElementById('trendsChart').getContext('2d');
            new Chart(trendsCtx, {
                type: 'line',
                data: {
                    labels: dashboardData.trends.map(d => new Date(d.date).toLocaleDateString()),
                    datasets: [
                        {
                            label: 'Impressions',
                            data: dashboardData.trends.map(d => d.impressions),
                            borderColor: '#4A6B7A',
                            backgroundColor: 'rgba(74, 107, 122, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Clicks',
                            data: dashboardData.trends.map(d => d.clicks),
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Top Keywords
            const topKeywords = dashboardData.pages[0]?.keywords?.slice(0, 10) || [];
            const keywordsHtml = topKeywords.map((keyword, i) => 
                `<div style="padding: 0.5rem; border-bottom: 1px solid #eee;">
                    ${i + 1}. ${keyword}
                </div>`
            ).join('');
            
            document.getElementById('topKeywords').innerHTML = keywordsHtml || 'No keywords data available';
        }

        function updateTable() {
            const tbody = document.getElementById('pagePerformanceTable');
            tbody.innerHTML = '';

            dashboardData.pages.forEach(page => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="page-link">${page.title}</span></td>
                    <td><span class="ranking-badge ${getRankingClass(page.avgPosition)}">${page.avgPosition}</span></td>
                    <td>${page.impressions.toLocaleString()}</td>
                    <td>${page.clicks.toLocaleString()}</td>
                    <td>${page.ctr}%</td>
                    <td>${page.conversions}</td>
                    <td>$${page.revenue.toLocaleString()}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function getRankingClass(position) {
            if (position <= 3) return 'ranking-excellent';
            if (position <= 10) return 'ranking-good';
            return 'ranking-needs-work';
        }

        function updateInsights() {
            const container = document.getElementById('insightsContainer');
            container.innerHTML = '';

            if (dashboardData.insights && dashboardData.insights.length > 0) {
                dashboardData.insights.forEach(insight => {
                    const insightDiv = document.createElement('div');
                    insightDiv.className = 'insight-item';
                    insightDiv.innerHTML = `
                        <div class="insight-type">${insight.type}</div>
                        <div class="insight-text">${insight.text}</div>
                    `;
                    container.appendChild(insightDiv);
                });
            } else {
                container.innerHTML = '<div class="loading">No insights available yet. More data needed for analysis.</div>';
            }
        }

        function updateLastUpdated() {
            document.getElementById('lastUpdated').textContent = 
                'Last updated: ' + new Date(dashboardData.lastUpdated).toLocaleString();
        }

        function refreshData() {
            document.getElementById('lastUpdated').textContent = 'Refreshing...';
            loadDashboardData();
        }

        function showError(message) {
            const container = document.querySelector('.dashboard-container');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.innerHTML = `
                <h3>⚠️ Error Loading Dashboard</h3>
                <p>${message}</p>
                <p>Please check the console for more details.</p>
            `;
            container.insertBefore(errorDiv, container.firstChild);
        }
    </script>
</body>
</html>
