<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Google Analytics 4 + Conversion Tracking -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J8H4YBGSHR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'G-J8H4YBGSHR', {
            'allow_enhanced_conversions': true,
            'send_page_view': true
        });

        // Track phone clicks
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('a[href^="tel:"]').forEach(link => {
                link.addEventListener('click', function() {
                    gtag('event', 'phone_call', {
                        'event_category': 'conversion',
                        'value': 175,
                        'currency': 'CAD'
                    });
                });
            });
        });
    </script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'G-J8H4YBGSHR', {
            'allow_enhanced_conversions': true,
            'send_page_view': true
        });

        // Track form submissions
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('form').forEach(form => {
                form.addEventListener('submit', function() {
                    gtag('event', 'generate_lead', {
                        'event_category': 'conversion',
                        'value': 175,
                        'currency': 'CAD'
                    });
                });
            });

            // Track phone clicks
            document.querySelectorAll('a[href^="tel:"]').forEach(link => {
                link.addEventListener('click', function() {
                    gtag('event', 'phone_call', {
                        'event_category': 'conversion',
                        'value': 175,
                        'currency': 'CAD'
                    });
                });
            });
        });
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextStep Therapy - Complete Tracking Template</title>
    
    <!-- Google Analytics 4 + Enhanced Conversion Tracking -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        // Replace G-XXXXXXXXXX with your actual GA4 Measurement ID
        gtag('config', 'G-XXXXXXXXXX', {
            'allow_enhanced_conversions': true,
            'allow_google_signals': true,
            'send_page_view': true,
            'custom_map': {
                'custom_parameter_1': 'therapy_type',
                'custom_parameter_2': 'landing_page',
                'custom_parameter_3': 'user_intent'
            }
        });

        // Therapy-specific conversion tracking
        function trackTherapyConversion(type, value = 150) {
            gtag('event', 'conversion', {
                'send_to': 'G-XXXXXXXXXX',
                'event_category': 'therapy_lead',
                'event_label': type,
                'value': value,
                'currency': 'CAD',
                'custom_parameters': {
                    'therapy_type': getTherapyType(),
                    'landing_page': window.location.pathname,
                    'user_intent': getUserIntent(),
                    'session_duration': getSessionDuration()
                }
            });
            console.log(`ðŸ“Š Conversion tracked: ${type} ($${value})`);
        }

        // Utility functions
        function getTherapyType() {
            const url = window.location.pathname.toLowerCase();
            if (url.includes('anxiety')) return 'anxiety_therapy';
            if (url.includes('depression')) return 'depression_therapy';
            if (url.includes('couples')) return 'couples_therapy';
            if (url.includes('virtual')) return 'virtual_therapy';
            if (url.includes('work') || url.includes('stress')) return 'work_stress_therapy';
            if (url.includes('university') || url.includes('student')) return 'student_therapy';
            return 'general_therapy';
        }

        function getUserIntent() {
            const sessionDuration = getSessionDuration();
            const pageViews = parseInt(sessionStorage.getItem('page_views') || '1');
            sessionStorage.setItem('page_views', (pageViews + 1).toString());
            
            if (sessionDuration > 180000 || pageViews >= 3) return 'high_intent';
            if (sessionDuration > 60000 || pageViews >= 2) return 'medium_intent';
            return 'low_intent';
        }

        function getSessionDuration() {
            const landingTime = parseInt(sessionStorage.getItem('landing_time') || Date.now().toString());
            return Date.now() - landingTime;
        }

        // Initialize session tracking
        if (!sessionStorage.getItem('landing_page')) {
            sessionStorage.setItem('landing_page', window.location.pathname);
            sessionStorage.setItem('landing_time', Date.now().toString());
        }
    </script>

    <!-- Call Tracking Setup -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Detect organic traffic
            const isOrganic = document.referrer.includes('google.') && 
                              !window.location.search.includes('gclid');
            
            // Use different phone numbers for tracking
            const phoneNumber = isOrganic ? '647-555-0100' : '647-555-0101';
            
            // Update phone numbers on page
            document.querySelectorAll('.phone-number').forEach(el => {
                el.textContent = phoneNumber;
                if (el.tagName === 'A') {
                    el.href = 'tel:' + phoneNumber.replace(/[^0-9]/g, '');
                }
            });

            // Track phone clicks
            document.querySelectorAll('a[href^="tel:"]').forEach(link => {
                link.addEventListener('click', function() {
                    gtag('event', 'phone_call', {
                        'event_category': 'conversion',
                        'event_label': isOrganic ? 'organic_call' : 'direct_call',
                        'value': 150
                    });
                    trackTherapyConversion('phone_call', 150);
                });
            });
        });
    </script>

    <!-- Form Tracking Setup -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const forms = document.querySelectorAll('form');
            
            forms.forEach(form => {
                let formStarted = false;
                
                // Track form start
                form.addEventListener('focusin', function() {
                    if (!formStarted) {
                        formStarted = true;
                        gtag('event', 'form_start', {
                            'event_category': 'engagement',
                            'event_label': form.id || 'contact_form'
                        });
                    }
                });
                
                // Track form submission
                form.addEventListener('submit', function(e) {
                    // Add hidden tracking fields
                    const trackingData = {
                        'landing_page': sessionStorage.getItem('landing_page'),
                        'referrer': document.referrer,
                        'session_duration': getSessionDuration().toString(),
                        'therapy_type': getTherapyType(),
                        'user_intent': getUserIntent()
                    };
                    
                    Object.keys(trackingData).forEach(fieldName => {
                        let field = form.querySelector(`[name="${fieldName}"]`);
                        if (!field) {
                            field = document.createElement('input');
                            field.type = 'hidden';
                            field.name = fieldName;
                            form.appendChild(field);
                        }
                        field.value = trackingData[fieldName];
                    });
                    
                    // Track conversion
                    const therapyType = form.querySelector('[name="therapy_type"]')?.value || 'general';
                    trackTherapyConversion(`form_submission_${therapyType}`, 150);
                    
                    gtag('event', 'generate_lead', {
                        'event_category': 'conversion',
                        'event_label': 'contact_form',
                        'value': 150,
                        'currency': 'CAD'
                    });
                });
            });
        });
    </script>
</head>
<body>
    <!-- Header with tracked phone number -->
    <header>
        <h1>NextStep Therapy</h1>
        <p>Call us: <a href="tel:6475550100" class="phone-number">647-555-0100</a></p>
    </header>

    <!-- Main content -->
    <main>
        <h2>Professional Therapy Services in Ontario</h2>
        <p>Get the support you need with our experienced therapists.</p>
        
        <!-- Contact form with enhanced tracking -->
        <form id="contact-form" method="POST" action="/submit-contact">
            <h3>Get Your Free Consultation</h3>
            
            <!-- Visible fields -->
            <div>
                <label for="name">Your Name *</label>
                <input type="text" id="name" name="name" required>
            </div>
            
            <div>
                <label for="email">Your Email *</label>
                <input type="email" id="email" name="email" required>
            </div>
            
            <div>
                <label for="phone">Your Phone</label>
                <input type="tel" id="phone" name="phone">
            </div>
            
            <div>
                <label for="therapy_type">What brings you here?</label>
                <select id="therapy_type" name="therapy_type">
                    <option value="">Select an option</option>
                    <option value="anxiety">Anxiety & Stress</option>
                    <option value="depression">Depression & Mood</option>
                    <option value="relationships">Relationship Issues</option>
                    <option value="work_stress">Work & Performance</option>
                    <option value="student">University/Student Issues</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div>
                <label for="message">Tell us more (optional)</label>
                <textarea id="message" name="message" rows="4"></textarea>
            </div>
            
            <!-- Hidden tracking fields (automatically populated) -->
            <input type="hidden" name="landing_page" value="">
            <input type="hidden" name="referrer" value="">
            <input type="hidden" name="session_duration" value="">
            <input type="hidden" name="user_intent" value="">
            
            <button type="submit">Get Your Free Consultation</button>
        </form>

        <!-- Booking widget tracking -->
        <div class="booking-section">
            <h3>Book Online</h3>
            <button onclick="trackBookingClick()" class="jane-booking-widget">
                Book Appointment Online
            </button>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <p>NextStep Therapy - Licensed CRPO Therapists</p>
        <p>Phone: <span class="phone-number">647-555-0100</span></p>
    </footer>

    <!-- Booking tracking script -->
    <script>
        function trackBookingClick() {
            gtag('event', 'begin_checkout', {
                'event_category': 'booking',
                'event_label': 'jane_app_widget',
                'value': 200
            });
            trackTherapyConversion('booking_start', 200);
            
            // Redirect to actual booking system
            window.open('https://your-jane-app-booking-url.com', '_blank');
        }
    </script>

    <!-- High-value action tracking -->
    <script>
        // Track scrolling (engagement)
        let scrollTracked = false;
        window.addEventListener('scroll', function() {
            if (!scrollTracked && window.scrollY > window.innerHeight * 0.5) {
                scrollTracked = true;
                gtag('event', 'scroll_50_percent', {
                    'event_category': 'engagement',
                    'event_label': 'page_engagement'
                });
            }
        });

        // Track time on page (3+ minutes = high intent)
        setTimeout(function() {
            gtag('event', 'time_on_page_3min', {
                'event_category': 'engagement',
                'event_label': 'high_intent_signal'
            });
        }, 180000); // 3 minutes
    </script>
</body>
</html>
